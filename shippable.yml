language: node_js

node_js:
  - 7.8.0

env:
  - BOOT_AS_ROOT=yes BOOT_JVM_OPTIONS="
    -client
    -XX:+TieredCompilation
    -XX:TieredStopAtLevel=1
    -Xmx2g
    -XX:+UseConcMarkSweepGC
    -XX:+CMSClassUnloadingEnabled
    -Xverify:none"


build:
  # pre_ci_boot:
  #   image_name: drydock/u14nod
  #   image_tag: prod
  #   pull: true
  #   options: '--privileged=true --net=bridge -e FOO=true -e BOO=false'

  ci:
    - npm install -g yarn
    - wget https://github.com/boot-clj/boot-bin/releases/download/latest/boot.sh
    - mv boot.sh boot && chmod a+x boot && sudo mv boot /usr/local/bin
    - boot
    - yarn install

    - yarn lint
    - yarn type:check
    - yarn test
    - boot test
    - boot release-ci

  on_success:
    - chmod a+x build/lumo
    - zip -j build/lumo.zip build/lumo

  cache: true

  cache_dir_list:
    - $SHIPPABLE_BUILD_DIR/node_modules
    - "~/.m2"
    - $SHIPPABLE_BUILD_DIR/tmp
    - "~/.boot/cache/lib"
    - "~/.boot/cache/bin"
